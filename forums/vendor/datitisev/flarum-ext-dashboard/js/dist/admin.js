module.exports=function(t){var n={};function e(a){if(n[a])return n[a].exports;var r=n[a]={i:a,l:!1,exports:{}};return t[a].call(r.exports,r,r.exports,e),r.l=!0,r.exports}return e.m=t,e.c=n,e.d=function(t,n,a){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:a})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(e.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var r in t)e.d(a,r,function(n){return t[n]}.bind(null,r));return a},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},e.p="",e(e.s=12)}([function(t,n){t.exports=flarum.core.compat.app},function(t,n){t.exports=flarum.core.compat["helpers/icon"]},function(t,n){t.exports=flarum.core.compat["components/Button"]},function(t,n){t.exports=flarum.core.compat["components/DashboardWidget"]},function(t,n){t.exports=flarum.core.compat["components/Modal"]},function(t,n){t.exports=flarum.core.compat.extend},function(t,n){t.exports=flarum.core.compat["components/AdminNav"]},function(t,n){t.exports=flarum.core.compat["components/DashboardPage"]},function(t,n,e){"use strict";class a{constructor(){this._queue=[]}enqueue(t,n){const e={priority:(n=Object.assign({priority:0},n)).priority,run:t};if(this.size&&this._queue[this.size-1].priority>=n.priority)return void this._queue.push(e);const a=function(t,n,e){let a=0,r=t.length;for(;r>0;){const s=r/2|0;let i=a+s;e(t[i],n)<=0?(a=++i,r-=s+1):r=s}return a}(this._queue,e,(t,n)=>n.priority-t.priority);this._queue.splice(a,0,e)}dequeue(){return this._queue.shift().run}get size(){return this._queue.length}}t.exports=class{constructor(t){if(!("number"==typeof(t=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:a},t)).concurrency&&t.concurrency>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${t.concurrency}\` (${typeof t.concurrency})`);if(!("number"==typeof t.intervalCap&&t.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${t.intervalCap}\` (${typeof t.intervalCap})`);if(!("number"==typeof t.interval&&Number.isFinite(t.interval)&&t.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${t.interval}\` (${typeof t.interval})`);this._carryoverConcurrencyCount=t.carryoverConcurrencyCount,this._isIntervalIgnored=t.intervalCap===1/0||0===t.interval,this._intervalCount=0,this._intervalCap=t.intervalCap,this._interval=t.interval,this._intervalId=null,this._intervalEnd=0,this._timeoutId=null,this.queue=new t.queueClass,this._queueClass=t.queueClass,this._pendingCount=0,this._concurrency=t.concurrency,this._isPaused=!1===t.autoStart,this._resolveEmpty=(()=>{}),this._resolveIdle=(()=>{})}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother()}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=(()=>{}),0===this._pendingCount&&(this._resolveIdle(),this._resolveIdle=(()=>{}))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=null}_intervalPaused(){const t=Date.now();if(null===this._intervalId){const n=this._intervalEnd-t;if(!(n<0))return null===this._timeoutId&&(this._timeoutId=setTimeout(()=>this._onResumeInterval(),n)),!0;this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0}return!1}_tryToStartAnother(){if(0===this.queue.size)return clearInterval(this._intervalId),this._intervalId=null,this._resolvePromises(),!1;if(!this._isPaused){const t=!this._intervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother)return this.queue.dequeue()(),t&&this._initializeIntervalIfNeeded(),!0}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||null!==this._intervalId||(this._intervalId=setInterval(()=>this._onInterval(),this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){for(0===this._intervalCount&&0===this._pendingCount&&(clearInterval(this._intervalId),this._intervalId=null),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;this._tryToStartAnother(););}add(t,n){return new Promise((e,a)=>{this.queue.enqueue(()=>{this._pendingCount++,this._intervalCount++;try{Promise.resolve(t()).then(t=>{e(t),this._next()},t=>{a(t),this._next()})}catch(t){a(t),this._next()}},n),this._tryToStartAnother()})}addAll(t,n){return Promise.all(t.map(t=>this.add(t,n)))}start(){if(this._isPaused)for(this._isPaused=!1;this._tryToStartAnother(););}pause(){this._isPaused=!0}clear(){this.queue=new this._queueClass}onEmpty(){return 0===this.queue.size?Promise.resolve():new Promise(t=>{const n=this._resolveEmpty;this._resolveEmpty=(()=>{n(),t()})})}onIdle(){return 0===this._pendingCount&&0===this.queue.size?Promise.resolve():new Promise(t=>{const n=this._resolveIdle;this._resolveIdle=(()=>{n(),t()})})}get size(){return this.queue.size}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}}},function(t,n,e){var a,r,s;r=[],void 0===(s="function"==typeof(a=function(){var t=/^v?(?:\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+)(\.(?:[x*]|\d+))?(?:-[\da-z\-]+(?:\.[\da-z\-]+)*)?(?:\+[\da-z\-]+(?:\.[\da-z\-]+)*)?)?)?$/i;function n(t){var n=t.replace(/^v/,"").replace(/\+.*$/,""),e=function(t,n){return-1===t.indexOf(n)?t.length:t.indexOf(n)}(n,"-"),a=n.substring(0,e).split(".");return a.push(n.substring(e+1)),a}function e(t){return isNaN(Number(t))?t:Number(t)}function a(n){if("string"!=typeof n)throw new TypeError("Invalid argument expected string");if(!t.test(n))throw new Error("Invalid argument not valid semver ('"+n+"' received)")}return function(t,r){[t,r].forEach(a);for(var s=n(t),i=n(r),o=0;o<Math.max(s.length-1,i.length-1);o++){var u=parseInt(s[o]||0,10),l=parseInt(i[o]||0,10);if(u>l)return 1;if(l>u)return-1}var d=s[s.length-1],c=i[i.length-1];if(d&&c){var h=d.split(".").map(e),m=c.split(".").map(e);for(o=0;o<Math.max(h.length,m.length);o++){if(void 0===h[o]||"string"==typeof m[o]&&"number"==typeof h[o])return-1;if(void 0===m[o]||"string"==typeof h[o]&&"number"==typeof m[o])return 1;if(h[o]>m[o])return 1;if(m[o]>h[o])return-1}}else if(d||c)return d?-1:1;return 0}})?a.apply(n,r):a)||(t.exports=s)},function(t,n){t.exports=flarum.core.compat["components/Switch"]},function(t,n){t.exports=flarum.core.compat["components/LoadingIndicator"]},function(t,n,e){"use strict";e.r(n);var a=e(5),r=e(6),s=e.n(r),i=e(7),o=e.n(i);function u(t,n){t.prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n}var l=e(0),d=e.n(l),c=e(3),h=e.n(c),p=function(t){function n(){return t.apply(this,arguments)||this}u(n,t);var e=n.prototype;return e.init=function(){t.prototype.init.call(this),this.months=[d.a.translator.trans("datitisev-dashboard.admin.dashboard.months.january"),d.a.translator.trans("datitisev-dashboard.admin.dashboard.months.february"),d.a.translator.trans("datitisev-dashboard.admin.dashboard.months.march"),d.a.translator.trans("datitisev-dashboard.admin.dashboard.months.april"),d.a.translator.trans("datitisev-dashboard.admin.dashboard.months.may"),d.a.translator.trans("datitisev-dashboard.admin.dashboard.months.june"),d.a.translator.trans("datitisev-dashboard.admin.dashboard.months.july"),d.a.translator.trans("datitisev-dashboard.admin.dashboard.months.august"),d.a.translator.trans("datitisev-dashboard.admin.dashboard.months.september"),d.a.translator.trans("datitisev-dashboard.admin.dashboard.months.october"),d.a.translator.trans("datitisev-dashboard.admin.dashboard.months.november"),d.a.translator.trans("datitisev-dashboard.admin.dashboard.months.december")]},e.content=function(){var t=d.a.forum.attribute("datitisev-dashboard.data"),n=t.userCount,e=t.discussionCount,a=t.postCount;return m("div",{className:"DashboardGraph--Categories"},m("div",{className:"DashboardGraph--Category Category--Users"},m("span",{className:"color"}),d.a.translator.trans("datitisev-dashboard.admin.dashboard.graph.users"),m("br",null),m("span",{className:"number"},n)),m("div",{className:"DashboardGraph--Category Category--Discussions"},m("span",{className:"color"}),d.a.translator.trans("datitisev-dashboard.admin.dashboard.graph.discussions"),m("br",null),m("span",{className:"number"},e)),m("div",{className:"DashboardGraph--Category Category--Posts"},m("span",{className:"color"}),d.a.translator.trans("datitisev-dashboard.admin.dashboard.graph.posts"),m("br",null),m("span",{className:"number"},a)))},e.className=function(){return"DashboardGraph"},e.graphView=function(){return m("div",{className:"DashboardGraph--Graph"},Object.keys(this.months).map(function(t){var n=months[t];return m("div",{className:"DashboardGraph--Month"},m("div",{className:"bars"},"BAR"),m("div",{className:"name"},n))}))},n}(h.a),f=e(2),v=e.n(f),b=e(1),_=e.n(b),g=e(4),y=e.n(g),x=e(8),I=e.n(x),N=e(9),C=function(t){function n(){return t.apply(this,arguments)||this}u(n,t);var e=n.prototype;return e.init=function(){this.loading=!0,this.needsUpdate=[],this.errors=[],this.getPackagesAndVersions()},e.className=function(){return"DashboardSettingsModal ExtensionUpdatesModal Modal--large"},e.title=function(){var t=this.needsUpdate.length;return t>0?d.a.translator.transChoice("datitisev-dashboard.admin.dashboard.updates.available",t,{count:t}):this.loading?d.a.translator.trans("datitisev-dashboard.admin.dashboard.updates.checking"):0===t?d.a.translator.trans("datitisev-dashboard.admin.dashboard.updates.none"):void 0},e.content=function(){var t=this;return m("div",{className:"PermissionGrid container"},m("table",{className:"PermissionGrid",style:this.errors||0!==this.needsUpdate.length?"":"display: none"},m("thead",null,m("tr",null,m("th",null,"Extension",this.loading&&m("span",null,"  ",m("i",{className:"fas fa-circle-notch fa-spin"}))),m("th",null,"Version Installed"),m("th",null,"New Version"))),m("tbody",null,Object.keys(this.needsUpdate).map(function(n){var e=t.needsUpdate[n];return m("tr",{className:"PermissionGrid-child"},m("td",null,e.name),m("td",null,e.oldVersion),m("td",null,e.newVersion))}),this.errors&&this.errors.map(function(t){return m("tr",{className:"ExtensionUpdatesModal--Error PermissionGrid-child"},m("td",null,t.name),m("td",null,t.version),m("td",null,t.error))}))),m("div",{style:0!==this.needsUpdate.length||this.errors||this.loading?"display: none":""},m("h3",null,d.a.translator.trans("datitisev-dashboard.admin.dashboard.updates.none"))))},e.getPackagesAndVersions=function(){var t=this,n=new I.a({intervalCap:2,interval:500}),e=Object.values(d.a.data.extensions).filter(function(t){return!t.version.startsWith("dev")}).map(function(n){return function(){return m.request({url:"https://packagist.org/packages/"+n.name+".json"}).then(function(e){e=e.package;var a=Object.keys(e.versions).filter(function(t){return!t.startsWith("dev")}).sort(N),r=a[a.length-1],s=n.version;if(r&&s!==r)return t.extensionUpdates=t.needsUpdate.length+1,t.needsUpdate.push({name:n.name,oldVersion:s,newVersion:r});m.redraw()}).catch(function(e){if(!e||"object"!=typeof e||!e.message)return!1;t.errors.push({name:n.name,version:n.version,error:e.status?e.status+": "+e.message:e.message})})}});n.addAll(e).then(function(){return t.loading=!1})},n}(y.a),E=e(10),w=e.n(E),D=e(11),P=e.n(D),q=function(t){function n(){return t.apply(this,arguments)||this}u(n,t);var e=n.prototype;return e.init=function(){t.prototype.init.call(this),this.extension=this.props.extension},e.className=function(){return"DashboardExtensionInfoModal Modal--large"},e.content=function(){var t=this.extension,n=this.isEnabled(t.id);return m("div",{className:"DashboardExtensionInfo"},m("div",{className:"Modal-close App-backControl"},this.loading&&m(P.a,{className:"LoadingIndicator--inline"}),n&&app.extensionSettings[t.id]&&v.a.component({icon:"fas fa-cog",onclick:function(){return app.extensionSettings[t.id]()},className:"Button Button--icon Button--link"}),!n&&v.a.component({icon:"fas fa-unlink",onclick:this.uninstall.bind(this),className:"Button Button--icon Button--link"}),v.a.component({icon:"fas fa-times",onclick:this.hide.bind(this),className:"Button Button--icon Button--link"})),m("div",{className:"DashboardExtensionInfo-Main"},m("spam",{className:"DashboardExtensionInfoMain-icon",style:t.icon},t.icon?_()(t.icon.name):""),m("h3",{className:"DashboardExtensionInfoMain-title"},t.extra["flarum-extension"].title),m("span",{className:"DashboardExtensionInfoMain-name"},t.name),m("span",{className:"DashboardExtensionInfoMain-version"},t.version),m("p",{className:"DashboardExtensionInfoMain-description"},t.description||""),m("p",{className:"DashboardExtensionInfoMain-useful"},m("p",{className:"DashboardExtensionInfoMainUseful-author"},t.authors&&1===t.authors.length?_()("fas fa-user"):_()("fas fa-users")," ",t.authors?t.authors.map(function(t){return t.name}).join(", "):"Unknown"),m("p",{className:"DashboardExtensionInfoMainUseful-source"},_()("fas fa-code")," ",t.source?m("a",{href:t.source.url,target:"_blank"},"Source"):"Unknown")),m("div",{className:"DashboardExtensionInfoMain-enabled"},w.a.component({state:n,children:n?"Enabled":"Disabled",onchange:this.toggle.bind(this,t.id)}))))},e.isDismissible=function(){return!0},e.isEnabled=function(t){return JSON.parse(app.data.settings.extensions_enabled).includes(t)},e.toggle=function(t){var n=this.isEnabled(t);app.request({url:app.forum.attribute("apiUrl")+"/extensions/"+t,method:"PATCH",data:{enabled:!n}}).then(function(){var e=JSON.parse(app.data.settings.extensions_enabled);n?e.splice(e.indexOf(t),1):e.push(t),app.data.settings.extensions_enabled=JSON.stringify(e),m.redraw()})},e.uninstall=function(){var t=this;return this.loading=!0,app.request({url:app.forum.attribute("apiUrl")+"/extensions/"+this.extension.id,method:"DELETE"}).then(function(){t.loading=!1,m.redraw()})},n}(y.a),M=function(t){function n(){return t.apply(this,arguments)||this}u(n,t);var e=n.prototype;return e.content=function(){var t=this,n=app.data.extensions;return m("div",null,m("div",{className:"DashboardExtensions--Title"},m("span",null,app.translator.trans("core.admin.nav.extensions_button")),v.a.component({children:_()("fas fa-upload"),className:"Button",onclick:function(){return app.modal.show(new C)}})),m("div",{className:"DashboardExtensions--List"},Object.values(n).map(function(n){return m("li",{className:"DashboardExtensions--Item "+(t.isEnabled(n.id)?"enabled":"disabled"),onclick:function(){return app.modal.show(new q({extension:n}))}},m("div",{className:"DashboardExtensionsItem-content"},m("spam",{className:"DashboardExtensionsItem-icon",style:n.icon},n.icon?_()(n.icon.name):""),m("label",{className:"DashboardExtensionsItem-title"},n.extra["flarum-extension"].title)))})))},e.isEnabled=function(t){return JSON.parse(app.data.settings.extensions_enabled).includes(t)},e.className=function(){return"DashboardExtensions"},n}(h.a);app.initializers.add("datitisev/dashboard",function(){Object(a.extend)(s.a.prototype,"items",function(t){t.remove("extensions")}),Object(a.extend)(o.a.prototype,"availableWidgets",function(t){t.push(m(p,null)),t.push(m(M,null))})})}]);
//# sourceMappingURL=admin.js.map